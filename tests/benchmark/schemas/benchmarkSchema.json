{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "wine-cellar-benchmark-v2.2",
  "title": "Wine Search Benchmark Schema",
  "description": "JSON Schema for validating wine search benchmark test cases",
  "type": "object",
  "required": ["version", "updated", "cases"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Semantic version of the benchmark file"
    },
    "updated": {
      "type": "string",
      "format": "date",
      "description": "Last update date in YYYY-MM-DD format"
    },
    "notes": {
      "type": "string",
      "description": "General notes about the benchmark suite"
    },
    "instructions": {
      "type": "object",
      "description": "Documentation for benchmark runners"
    },
    "cases": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/BenchmarkCase"
      }
    }
  },
  "$defs": {
    "BenchmarkCase": {
      "type": "object",
      "required": ["id", "query", "country", "challenges", "gold_canonical_name", "producer"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^\\d{2}_[a-z]{2,4}_[a-z0-9_]+$",
          "description": "Unique case ID: NN_CC_name format (e.g., 01_sa_nederburg)"
        },
        "query": {
          "type": "string",
          "minLength": 5,
          "description": "Search query as user would type it"
        },
        "country": {
          "type": "string",
          "minLength": 2,
          "description": "Wine's country of origin"
        },
        "producer": {
          "type": "string",
          "minLength": 2,
          "description": "Canonical producer/winery name for partial-credit scoring"
        },
        "vintage": {
          "type": "integer",
          "minimum": 1900,
          "maximum": 2030,
          "description": "Vintage year (omit for NV wines)"
        },
        "challenges": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$"
          },
          "description": "Challenge categories this case tests (snake_case)"
        },
        "gold_canonical_name": {
          "type": "string",
          "minLength": 5,
          "description": "Expected canonical wine name with correct spelling/diacritics"
        },
        "expected": {
          "$ref": "#/$defs/ExpectedConstraints"
        },
        "notes": {
          "type": "string",
          "description": "Human explanation of why this case exists or what it stresses"
        }
      },
      "additionalProperties": false
    },
    "ExpectedConstraints": {
      "type": "object",
      "properties": {
        "min_results": {
          "type": "integer",
          "minimum": 1,
          "maximum": 20,
          "description": "Minimum number of SERP results expected in live mode"
        },
        "must_include_domains": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z0-9][a-z0-9.-]*\\.[a-z]{2,}$"
          },
          "description": "Domains that must appear in top results (e.g., wine-searcher.com)"
        },
        "must_include_source_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["producer_website", "critic", "competition", "retailer", "aggregator"]
          },
          "description": "Source types required in results"
        }
      },
      "additionalProperties": false
    },
    "ChallengeTaxonomy": {
      "description": "Standardized challenge categories for analysis",
      "enum": [
        "long_name",
        "very_long_name",
        "short_query",
        "hyphenated_producer",
        "apostrophe",
        "definite_article",
        "diacritics_optional",
        "umlaut_optional",
        "special_chars_optional",
        "accented_grape",
        "classification_reserva",
        "classification_gran_reserva",
        "premier_cru",
        "pradikat_term",
        "gg_term",
        "gg_abbrev",
        "igt_tokens",
        "single_vineyard",
        "vineyard_name",
        "vineyard_tokens",
        "finca_keyword",
        "estate_name",
        "estate_token",
        "brand_vs_producer",
        "producer_as_brand",
        "brand_only",
        "brand_line",
        "brand_family_range",
        "producer_acronym",
        "producer_small_footprint",
        "numeric_bin",
        "numeric_cuvee",
        "subregion_token",
        "appellation_token",
        "region_tokens",
        "non_vintage",
        "super_tuscan",
        "appassimento_style",
        "prestige_champagne",
        "retail_noise",
        "many_retail_pages",
        "icon_wine",
        "icon_wine_short_query",
        "rare_high_value",
        "high_value",
        "low_critic_coverage",
        "tier_name_hidden",
        "tier_disambiguation",
        "range_qualifier",
        "translation_variant",
        "generic_appellation",
        "flagship",
        "name_collision",
        "cuvee_name",
        "cuvee_spelling_variant",
        "abbreviation_tokens",
        "marketing_phrase_tokens",
        "series_disambiguation",
        "near_competitor_disambiguation",
        "pinot_disambiguation",
        "barolo_classic",
        "village_token",
        "catalan_tokens",
        "spanish_article",
        "medal_word_false_positive"
      ]
    }
  }
}
