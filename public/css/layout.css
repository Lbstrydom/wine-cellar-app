* { box-sizing: border-box; margin: 0; padding: 0; }

html {
  font-size: 16px;
  -webkit-text-size-adjust: 100%;
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg-dark);
  color: var(--text);
  min-height: 100vh;
  padding: 1rem;
  font-size: 1rem;
  line-height: 1.5;
}

h1, h2, h3 {
  font-family: 'Cormorant Garamond', serif;
  font-weight: 600;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 0 1.5rem;
  border-bottom: 1px solid var(--border);
  margin-bottom: 1.5rem;
  gap: 1rem;
  flex-wrap: wrap;
}

header h1 {
  font-size: 2rem;
  letter-spacing: 0.05em;
}

header .search-trigger {
  margin-right: auto;
  margin-left: 1.5rem;
}

.stats {
  display: flex;
  gap: 2rem;
  font-size: 0.9rem;
}

.stat {
  text-align: center;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--accent);
}

.stat-label {
  color: var(--text-muted);
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* Navigation tabs */
.tabs {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

.tab {
  padding: 0.6rem 1.2rem;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.85rem;
  transition: all 0.2s;
}

.tab:hover { background: var(--bg-slot-hover); }
.tab.active { background: var(--accent); border-color: var(--accent); color: var(--text-on-light); }

/* Views */
.view { display: none; }
.view.active { display: block; }

/* Zone sections */
.zone {
  margin-bottom: 2rem;
}

.zone-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.zone-title {
  font-size: 1.1rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.15em;
}

/* Zoom controls */
.zoom-controls {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.zoom-controls .btn-small {
  padding: 0.25rem 0.5rem;
  font-size: 1rem;
  min-width: 32px;
}

.zoom-level {
  font-size: 0.75rem;
  color: var(--text-muted);
  min-width: 40px;
  text-align: center;
}

/* Cellar container for zoom */
.cellar-container {
  position: relative;
  overflow: auto;
  touch-action: pan-x pan-y;
}

.cellar-container.zoomed {
  overflow: auto;
  touch-action: none;
}

/* Cellar grid */
.cellar-grid {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.cellar-row {
  display: flex;
  gap: 3px;
  align-items: center;
}

.row-label {
  width: 80px;
  min-width: 80px;
  font-size: 0.7rem;
  color: var(--text-muted);
  text-align: right;
  padding-right: 8px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-end;
}

.row-label .zone-name {
  font-size: 0.6875rem;            /* Phase 1.3: was 0.65rem — 11px floor */
  font-weight: 500;
  color: var(--accent);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 75px;
}

/* Storage Areas Container */
.storage-areas {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  margin-bottom: 1rem;
}

.storage-areas .zone {
  margin-bottom: 0;
}

/* Cellar Container with Zone Labels */
.cellar-container {
  display: flex;
  gap: 0.5rem;
}

.zone-labels {
  display: flex;
  flex-direction: column;
  gap: 0;
  padding-top: 0;
  min-width: 110px;
}

.zone-label {
  display: flex;
  align-items: center;
  padding: 0 0.5rem;
  font-size: 0.7rem;
  color: var(--text-muted);
  border-left: 3px solid var(--accent);
  background: rgba(var(--accent-rgb), 0.1);
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

/* Fridge grid */
.fridge-section {
  background: var(--fridge-bg);
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 1.5rem;
}

.fridge-grid {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.fridge-row {
  display: flex;
  gap: 3px;
}

/* Wine list view */
.wine-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 0.75rem;
}

/* Virtual list mode - single column with fixed height for windowing */
.wine-list.virtual-mode {
  display: block;
  height: calc(100vh - 280px);
  min-height: 400px;
  overflow-y: auto;
}

.wine-list.virtual-mode .virtual-list-wrapper {
  position: relative;
  width: 100%;
}

.wine-list.virtual-mode .virtual-list-content {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.wine-list.virtual-mode .virtual-list-item {
  box-sizing: border-box;
}

/* Responsive */
@media (max-width: 768px) {
  .slot {
    width: 70px;
    height: 52px;  /* Phase 3.5 fix: was 44px */
  }

  .stats {
    gap: 1rem;
  }

  header {
    flex-direction: column;
    gap: 1rem;
  }

  .pairing-filters {
    flex-direction: column;
    gap: 1rem;
  }

  .image-upload-area {
    padding: 1rem;
  }

  .upload-prompt span {
    font-size: 0.9rem;
  }

  #image-preview img {
    max-height: 150px;
  }
}

@media (max-width: 500px) {
  .form-row {
    flex-direction: column;
    gap: 0;
  }

  .form-field {
    margin-bottom: 1rem;
  }
}

/* ============================================================
   MOBILE MENU
   ============================================================ */

.mobile-menu-btn {
  display: none;
  flex-direction: column;
  justify-content: center;
  gap: 5px;
  width: 44px;
  height: 44px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  padding: 10px;
  z-index: 60;
  position: relative;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

.mobile-menu-btn span {
  display: block;
  width: 100%;
  height: 2px;
  background: var(--text);
  transition: all 0.2s;
  pointer-events: none; /* Ensure clicks go to parent button */
}

.tabs-container {
  display: flex;
  gap: 0.5rem;
}

/* ============================================================
   RESPONSIVE DESIGN
   ============================================================ */

/* Tablet (768px and below) */
@media (max-width: 768px) {
  body {
    padding: 0.5rem;
    font-size: 1rem;
  }

  header {
    flex-direction: column;
    gap: 1rem;
    padding: 0.75rem 0;
  }

  header h1 {
    font-size: 1.5rem;
  }

  .stats {
    width: 100%;
    justify-content: space-around;
    gap: 1rem;
  }

  .stat-value {
    font-size: 1.3rem;
  }

  .stat-label {
    font-size: 0.85rem;
  }

  /* Show hamburger menu on tablet and below */
  .mobile-menu-btn {
    display: flex;
  }

  .tabs {
    position: relative;
  }

  .tabs-container {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    flex-direction: column;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    margin-top: 0.5rem;
    z-index: 50;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  .tabs-container.open {
    display: flex;
  }

  .tab {
    width: 100%;
    text-align: center;
    padding: 0.9rem;
    font-size: 1rem;
  }

  /* Grid wrapper for horizontal scroll */
  .cellar-grid,
  .fridge-grid {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 0.5rem;
  }

  /* Grid adjustments - keep readable size, allow scroll */
  .slot {
    width: 80px;
    height: 58px;  /* Phase 3.5 fix: was 50px */
    padding: 4px;
    flex-shrink: 0;
  }

  .slot-name {
    font-size: 0.75rem;
  }

  .slot-vintage {
    font-size: 0.6875rem;          /* Phase 1.3: was 0.65rem — 11px floor */
  }

  .row-label {
    width: 60px;
    min-width: 60px;
    font-size: 0.6875rem;          /* Phase 1.3: was 0.65rem — 11px floor */
    padding-right: 4px;
    flex-shrink: 0;
  }

  .row-label .zone-name {
    font-size: 0.6875rem;          /* Phase 1.3: was 0.55rem — 11px floor */
    max-width: 55px;
  }

  .cellar-row,
  .fridge-row {
    flex-wrap: nowrap;
  }

  /* Wine list filters */
  .wine-list-filters {
    flex-direction: column;
    align-items: stretch;
  }

  .wine-list-filters .filter-group {
    width: 100%;
  }

  .wine-list-filters select {
    flex: 1;
  }

  .wine-list-filters .search-group {
    width: 100%;
  }

  /* Wine list */
  .wine-list {
    grid-template-columns: 1fr;
  }

  .wine-list.virtual-mode {
    height: calc(100vh - 320px);
    min-height: 300px;
  }

  /* Modals */
  .modal {
    width: 95%;
    max-height: 85vh;
    padding: 1rem;
  }

  .modal-actions {
    flex-wrap: wrap;
  }

  .modal-actions .btn {
    flex: 1 1 auto;
    min-width: 80px;
  }
}

/* Mobile (480px and below) */
@media (max-width: 480px) {
  body {
    font-size: 1rem;
  }

  /* Show hamburger menu */
  .mobile-menu-btn {
    display: flex;
  }

  .tabs {
    position: relative;
  }

  .tabs-container {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    flex-direction: column;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    margin-top: 0.5rem;
    z-index: 50;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  .tabs-container.open {
    display: flex;
  }

  .tab {
    width: 100%;
    text-align: center;
    padding: 0.9rem;
    font-size: 1rem;
  }

  /* Grid - keep readable size, horizontal scroll */
  .cellar-grid,
  .fridge-grid {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    gap: 3px;
  }

  .cellar-row,
  .fridge-row {
    gap: 3px;
    flex-wrap: nowrap;
  }

  .slot {
    width: 75px;
    height: 56px;  /* Phase 3.5 fix: was 48px */
    padding: 3px;
    flex-shrink: 0;
  }

  .slot-name {
    font-size: 0.75rem;            /* Phase 1.3: no reduction below base 12px */
    -webkit-line-clamp: 2;
  }

  .slot-vintage {
    font-size: 0.6875rem;          /* Phase 1.3: was 0.6rem — 11px floor */
  }

  .slot-loc {
    font-size: 0.6875rem;          /* Phase 1.3: was 0.55rem — 11px floor */
  }

  .row-label {
    width: 50px;
    min-width: 50px;
    font-size: 0.6875rem;          /* Phase 1.3: was 0.6rem — 11px floor */
    flex-shrink: 0;
  }

  .row-label .zone-name {
    font-size: 0.6875rem;          /* Phase 1.3: was 0.5rem — 11px floor */
    max-width: 45px;
  }

  /* Zone headers */
  .zone-title {
    font-size: 1rem;
  }

  .fridge-section {
    padding: 0.75rem;
  }

  /* Stats */
  .stat-value {
    font-size: 1.2rem;
  }

  .stat-label {
    font-size: 0.8rem;
  }

  /* Wine list stats */
  .wine-list-stats {
    flex-wrap: wrap;
    gap: 0.5rem;
    font-size: 0.9rem;
  }

  /* Wine cards */
  .wine-card {
    padding: 0.75rem;
  }

  .wine-count {
    font-size: 1.3rem;
    min-width: 30px;
  }

  .wine-name {
    font-size: 1rem;
  }

  .wine-meta {
    font-size: 0.9rem;
  }

  /* Pairing view */
  .natural-pairing {
    padding: 1rem;
  }

  .natural-pairing input[type="text"] {
    font-size: 1rem;
    padding: 0.9rem 1rem;
  }

  .signal-grid {
    gap: 0.5rem;
  }

  .signal-btn {
    padding: 0.5rem 0.9rem;
    font-size: 0.9rem;
  }

  /* History */
  .history-item {
    flex-direction: column;
    gap: 0.5rem;
  }

  .history-date {
    align-self: flex-start;
    font-size: 0.9rem;
  }

  .history-wine {
    font-size: 1rem;
  }

  .history-meta,
  .history-occasion,
  .history-pairing,
  .history-notes {
    font-size: 0.9rem;
  }

  .history-rating {
    align-self: flex-start;
  }

  /* Buttons */
  .btn {
    padding: 0.6rem 0.9rem;
    font-size: 0.9rem;
  }

  /* Reduce list */
  .reduce-name {
    font-size: 1rem;
  }

  .reduce-meta {
    font-size: 0.9rem;
  }

  .reduce-locations {
    font-size: 0.85rem;
  }

  /* Modal fields */
  .modal-field label {
    font-size: 0.85rem;
  }

  .modal-field span {
    font-size: 1rem;
  }

  /* Form fields */
  .form-field label,
  .form-label {
    font-size: 0.85rem;
  }

  .form-field input,
  .form-field select {
    font-size: 1rem;
    padding: 0.7rem 0.9rem;
  }

  /* Toast */
  .toast {
    left: 1rem;
    right: 1rem;
    transform: translateY(100px);
    width: auto;
    font-size: 1rem;
  }

  .toast.show {
    transform: translateY(0);
  }
}

/* Very small screens (360px and below) */
@media (max-width: 360px) {
  /* Keep slots readable - scroll instead of shrinking */
  .slot {
    width: 70px;
    height: 52px;  /* Phase 3.5 fix: was 45px */
  }

  .row-label {
    width: 40px;
    min-width: 40px;
    font-size: 0.6875rem;          /* Phase 1.3: was 0.55rem — 11px floor */
  }

  .row-label .zone-name {
    display: none;
  }

  header h1 {
    font-size: 1.25rem;
  }

  .stats {
    gap: 0.5rem;
  }

  .stat-value {
    font-size: 1.1rem;
  }

  .stat-label {
    font-size: 0.75rem;
  }

  .tab {
    font-size: 0.95rem;
    padding: 0.8rem;
  }

  .btn {
    font-size: 0.85rem;
  }
}

/* Responsive Settings */
@media (max-width: 600px) {
  .settings-rule {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .credential-inputs {
    flex-direction: column;
  }

  .preference-labels span:nth-child(2) {
    display: none;
  }

  .manual-window-entry {
    flex-direction: column;
    align-items: flex-start;
  }

  .window-entry {
    flex-wrap: wrap;
  }

  .window-status {
    margin-left: 0;
    margin-top: 0.25rem;
  }
}

/* PWA standalone mode adjustments */
@media (display-mode: standalone) {
  /* Add padding for notch/safe areas on mobile */
  body {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  /* Hide install button when already installed */
  #install-app-btn {
    display: none !important;
  }
}

html[data-text-size="small"] {
  --text-size-multiplier: 0.875;
}

html[data-text-size="medium"] {
  --text-size-multiplier: 1;
}

html[data-text-size="large"] {
  --text-size-multiplier: 1.125;
}

/* Apply text size to key elements */
body {
  font-size: calc(1rem * var(--text-size-multiplier));
}

.slot-name {
  font-size: calc(0.75rem * var(--text-size-multiplier));   /* Phase 1.3: was 0.65rem — slot-name base 12px */
}

.slot-vintage {
  font-size: calc(0.6875rem * var(--text-size-multiplier)); /* Phase 1.3: was 0.55rem — 11px floor */
}
